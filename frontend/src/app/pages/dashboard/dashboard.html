<div class="page-container">
  <h2>SOW Projects History</h2>

  <!-- Card shown when there are no projects -->
  <div *ngIf="projects.length === 0 && !isLoading" class="no-projects-card">
    <span class="material-symbols-outlined icon-large">folder_off</span>
    <p>You haven't created any SOW projects yet.</p>
    <a routerLink="/" class="btn-primary">Create a New SOW Project</a>
  </div>

  <!-- List of project cards -->
  <div class="project-list" *ngIf="projects.length > 0">
    <div class="project-card" *ngFor="let project of projects">
      <div class="project-info">
        <div class="project-name-line">
          <span class="project-status-dot" [ngClass]="project.status.toLowerCase().replace('_', '-')"></span>
          <!-- This is the main conditional block for view/edit mode -->
          <div *ngIf="editingProjectId !== project.id; else editProjectBlock">
            <!-- View Mode -->
            <a class="project-name" [routerLink]="['/projects', project.id]">
              {{ project.projectName }}
            </a>
            <span class="material-symbols-outlined edit-icon" (click)="startProjectNameEdit(project, $event)" title="Rename Project">
              edit_square
            </span>
          </div>

          <!-- Edit Mode Template -->
          <ng-template #editProjectBlock>
            <div class="edit-form-inline">
              <input type="text" [(ngModel)]="project.projectName" (keyup.enter)="saveProjectName(project)" (keyup.escape)="cancelProjectNameEdit(project)" (click)="$event.stopPropagation()">
              <button class="save-btn" (click)="saveProjectName(project)" title="Save"><span class="material-symbols-outlined">check</span></button>
              <button class="cancel-btn" (click)="cancelProjectNameEdit(project)" title="Cancel"><span class="material-symbols-outlined">close</span></button>
            </div>
          </ng-template>
        </div>

        <!-- THIS IS THE NEW BLOCK -->
        <div class="project-status-line">
          <b>Status:</b> 
          <span class="status-tag" [ngClass]="'status-' + project.status.toLowerCase().replace('_', '-')">
            {{ project.status.replace('_', ' ') | titlecase }}
          </span>
        </div>
        <!-- END OF NEW BLOCK -->

        <div class="project-meta">
          <span>ID: {{ project.id }}</span>
          <span>Created: {{ project.createdAt | date:'short' }}</span>
        </div>
      </div>
      <div class="project-actions">
        <a [routerLink]="['/projects', project.id]" class="action-btn-primary">
          View Project
          <!-- <span class="material-symbols-outlined">arrow_forward</span> -->
        </a>
        <button class="action-btn-icon" (click)="deleteProject(project.id, project.projectName)" title="Delete Project">
          <span class="material-symbols-outlined">delete</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="loading-indicator">
    <p>Loading projects...</p>
  </div>
</div>