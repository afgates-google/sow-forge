<div class="page-container">
  <h2>Application Settings</h2>
  <p>Modify global settings that control the backend AI processes and services.</p>

  <div class="content-card">
    <form *ngIf="settings" (ngSubmit)="saveSettings()">
      <!-- Tab Navigation -->
      <div class="tab-nav">
        <button type="button" class="tab-button" [class.active]="activeTab === 'general'" (click)="activeTab = 'general'">General</button>
        <button type="button" class="tab-button" [class.active]="activeTab === 'gcs'" (click)="activeTab = 'gcs'">GCS Buckets</button>
        <button type="button" class="tab-button" [class.active]="activeTab === 'docai'" (click)="activeTab = 'docai'">Document AI</button>
        <button type="button" class="tab-button" [class.active]="activeTab === 'analysis'" (click)="activeTab = 'analysis'">Analysis AI</button>
        <button type="button" class="tab-button" [class.active]="activeTab === 'sowgen'" (click)="activeTab = 'sowgen'">SOW Gen AI</button>
        <button type="button" class="tab-button" [class.active]="activeTab === 'integrations'" (click)="activeTab = 'integrations'">Integrations</button>
      </div>

      <!-- Tab Content Area -->
      <div class="tab-content">
        <!-- General Tab -->
        <div *ngIf="activeTab === 'general'">
          <div class="form-group">
            <label for="gcp_project_id">GCP Project ID</label>
            <input type="text" id="gcp_project_id" [(ngModel)]="settings.gcp_project_id" name="gcp_project_id">
          </div>
          <div class="form-group">
            <label for="vertex_ai_location">Vertex AI Location</label>
            <input type="text" id="vertex_ai_location" [(ngModel)]="settings.vertex_ai_location" name="vertex_ai_location">
          </div>
        </div>

        <!-- GCS Buckets Tab -->
        <div *ngIf="activeTab === 'gcs'">
          <div class="form-group"><label for="gcs_uploads_bucket">Uploads Bucket</label><input type="text" id="gcs_uploads_bucket" [(ngModel)]="settings.gcs_uploads_bucket" name="gcs_uploads_bucket"></div>
          <div class="form-group"><label for="gcs_processed_text_bucket">Processed Text Bucket</label><input type="text" id="gcs_processed_text_bucket" [(ngModel)]="settings.gcs_processed_text_bucket" name="gcs_processed_text_bucket"></div>
          <div class="form-group"><label for="gcs_batch_output_bucket">Batch Output Bucket</label><input type="text" id="gcs_batch_output_bucket" [(ngModel)]="settings.gcs_batch_output_bucket" name="gcs_batch_output_bucket"></div>
          <div class="form-group"><label for="gcs_template_samples_bucket">Template Samples Bucket</label><input type="text" id="gcs_template_samples_bucket" [(ngModel)]="settings.gcs_template_samples_bucket" name="gcs_template_samples_bucket"></div>
          <div class="form-group"><label for="gcs_templates_bucket">Templates Bucket</label><input type="text" id="gcs_templates_bucket" [(ngModel)]="settings.gcs_templates_bucket" name="gcs_templates_bucket"></div>
        </div>

        <!-- Document AI Tab -->
        <div *ngIf="activeTab === 'docai'">
          <div class="form-group"><label for="docai_processor_id">Processor ID</label><input type="text" id="docai_processor_id" [(ngModel)]="settings.docai_processor_id" name="docai_processor_id"></div>
          <div class="form-group"><label for="docai_location">Location</label><input type="text" id="docai_location" [(ngModel)]="settings.docai_location" name="docai_location"></div>
          <div class="form-group"><label for="sync_page_limit">Sync Page Limit</label><input type="number" id="sync_page_limit" [(ngModel)]="settings.sync_page_limit" name="sync_page_limit"></div>
        </div>
        
        <!-- Analysis AI Tab -->
        <div *ngIf="activeTab === 'analysis'">
          <div class="form-group"><label for="legislative_analysis_model">Analysis Model</label><select id="legislative_analysis_model" [(ngModel)]="settings.legislative_analysis_model" name="legislative_analysis_model"><option *ngFor="let model of availableModels" [value]="model">{{ model }}</option></select></div>
          <div class="form-group"><label for="analysis_model_temperature">Analysis Temperature</label><input type="number" step="0.1" min="0" max="2" id="analysis_model_temperature" [(ngModel)]="settings.analysis_model_temperature" name="analysis_model_temperature"></div>
          <div class="form-group"><label for="default_document_category">Default Document Category</label><input type="text" id="default_document_category" [(ngModel)]="settings.default_document_category" name="default_document_category"></div>
          <div class="form-group"><label for="default_analysis_prompt_id">Default Analysis Prompt ID</label><input type="text" id="default_analysis_prompt_id" [(ngModel)]="settings.default_analysis_prompt_id" name="default_analysis_prompt_id"></div>
          <div class="form-group map-editor">
            <label>Prompt Mapping (Category to Prompt ID)</label>
            <div *ngFor="let item of promptMappingArray; let i = index" class="map-item">
              <input type="text" [(ngModel)]="item.key" [name]="'prompt_map_key_' + i" placeholder="Category Name">
              <span>:</span>
              <input type="text" [(ngModel)]="item.value" [name]="'prompt_map_value_' + i" placeholder="Prompt Document ID">
            </div>
          </div>
        </div>

        <!-- SOW Generation AI Tab -->
        <div *ngIf="activeTab === 'sowgen'">
          <div class="form-group"><label for="sow_generation_model">SOW Generation Model</label><select id="sow_generation_model" [(ngModel)]="settings.sow_generation_model" name="sow_generation_model"><option *ngFor="let model of availableModels" [value]="model">{{ model }}</option></select></div>
          <div class="form-group"><label for="sow_generation_model_temperature">SOW Gen Temperature</label><input type="number" step="0.1" min="0" max="2" id="sow_generation_model_temperature" [(ngModel)]="settings.sow_generation_model_temperature" name="sow_generation_model_temperature"></div>
          <div class="form-group"><label for="sow_generation_max_tokens">SOW Gen Max Tokens</label><input type="number" id="sow_generation_max_tokens" [(ngModel)]="settings.sow_generation_max_tokens" name="sow_generation_max_tokens"></div>
          <div class="form-group"><label for="sow_generation_prompt_id">SOW Gen Prompt ID</label><input type="text" id="sow_generation_prompt_id" [(ngModel)]="settings.sow_generation_prompt_id" name="sow_generation_prompt_id"></div>
          <div class="form-group"><label for="sow_title_prefix">SOW Title Prefix</label><input type="text" id="sow_title_prefix" [(ngModel)]="settings.sow_title_prefix" name="sow_title_prefix"></div>
          <div class="form-group"><label for="ai_review_tag_format">AI Review Tag Format</label><input type="text" id="ai_review_tag_format" [(ngModel)]="settings.ai_review_tag_format" name="ai_review_tag_format"></div>
        </div>

        <!-- Integrations Tab -->
        <div *ngIf="activeTab === 'integrations'">
          <div class="form-group"><label for="sow_generation_func_url">SOW Generation Func URL</label><input type="text" id="sow_generation_func_url" [(ngModel)]="settings.sow_generation_func_url" name="sow_generation_func_url"></div>
          <div class="form-group"><label for="template_generation_func_url">Template Generation Func URL</label><input type="text" id="template_generation_func_url" [(ngModel)]="settings.template_generation_func_url" name="template_generation_func_url"></div>
          <div class="form-group"><label for="create_google_doc_func_url">Create Google Doc Func URL</label><input type="text" id="create_google_doc_func_url" [(ngModel)]="settings.create_google_doc_func_url" name="create_google_doc_func_url"></div>
          <div class="form-group"><label for="google_docs_api_scopes">Google Docs API Scopes</label><input type="text" id="google_docs_api_scopes" [(ngModel)]="settings.google_docs_api_scopes" name="google_docs_api_scopes"></div>
          <div class="form-group"><label for="gsuite_delegated_admin_email">G-Suite Delegated Admin</label><input type="email" id="gsuite_delegated_admin_email" [(ngModel)]="settings.gsuite_delegated_admin_email" name="gsuite_delegated_admin_email"></div>
        </div>
      </div>
      
      <!-- Action Bar -->
      <div class="actions">
        <button type="submit">Save All Settings</button>
        <span class="status-message">{{ statusMessage }}</span>
      </div>
    </form>
  </div>
</div>